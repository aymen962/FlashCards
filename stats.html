<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Statistiques 2026</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>
<body class="bg-light">
    <div class="container my-5" style="max-width: 950px;">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <a href="index.html" class="btn btn-outline-secondary">‚Üê Retour</a>
            <h1 class="mb-0">Calendrier 2026</h1>
            <div class="badge bg-fire fs-5" id="streakBadge">üî• 0 Jours</div>
        </div>

        <div class="card shadow-sm border-0 p-4 mb-4 overflow-auto">
            <h5 class="fw-bold mb-3">R√©visions (Cartes)</h5>
            <div class="heatmap-wrapper">
                <div class="heatmap-year" id="heatmapQuiz"></div>
            </div>
        </div>

        <div class="card shadow-sm border-0 p-4 overflow-auto">
            <h5 class="fw-bold mb-3">Focus (Temps d'√©tude)</h5>
            <div class="heatmap-wrapper">
                <div class="heatmap-year" id="heatmapTimer"></div>
            </div>
            <div class="d-flex justify-content-end align-items-center mt-3 gap-2 small text-muted">
                <span>Moins</span>
                <div class="sq level-0"></div><div class="sq level-1"></div>
                <div class="sq level-2"></div><div class="sq level-3"></div>
                <div class="sq level-4"></div>
                <span>Plus</span>
            </div>
        </div>
    </div>

    <script src="script.js"></script>

    <script>
        // On r√©cup√®re les donn√©es locales
        const localStats = JSON.parse(localStorage.getItem("flash_stats")) || {};
        const localTimerStats = JSON.parse(localStorage.getItem("study_timer_stats")) || {};
        const getFormatDate = (d) => `${d.getFullYear()}-${String(d.getMonth() + 1).padStart(2, '0')}-${String(d.getDate()).padStart(2, '0')}`;
        
        function renderHeatmap(containerId, dataMap, isTime) {
            const container = document.getElementById(containerId);
            if (!container) return;
            
            const start = new Date(2026, 0, 1);
            const end = new Date(2026, 11, 31);
            const today = new Date();
            
            for (let d = new Date(start); d <= end; d.setDate(d.getDate() + 1)) {
                const ds = getFormatDate(d);
                const val = dataMap[ds] || 0;
                let level = 0;
                
                if (isTime) {
                    level = val > 10800 ? 4 : val > 5400 ? 3 : val > 1800 ? 2 : val > 0 ? 1 : 0;
                } else {
                    level = val > 15 ? 4 : val > 8 ? 3 : val > 4 ? 2 : val > 0 ? 1 : 0;
                }
                
                const sq = document.createElement("div");
                sq.className = `sq level-${level}`;
                if (d > today) sq.style.opacity = "0.2";
                sq.title = isTime ? `${ds} : ${Math.floor(val/60)}m` : `${ds} : ${val} cartes`;
                container.appendChild(sq);
            }
        }

        // Rendu des calendriers
        renderHeatmap("heatmapQuiz", localStats, false);
        renderHeatmap("heatmapTimer", localTimerStats, true);

        // Le calcul du streak est d√©j√† g√©r√© par script.js, 
        // mais nous mettons √† jour l'affichage sp√©cifique ici si besoin
    </script>
</body>
</html>